- Start Date: 2020-04-20
- Target Major Version: Vue Router 4.x
- Reference Issues:
- Implementation PR:

# Summary

Given the changes to functional components in Vue 3, `KeepAlive` and `Transition` usage combined with `RouterView` is no longer possible by simply wrapping `RouterView` with `KeepAlive`/`Transition`. Instead we need a way to directly provide the component rendered by `RouterView` to those components:

```vue
<router-view v-slot="{ Component, attrs }">
  <transition :name="transitionName" mode="out-in">
    <component v-if="Component" :is="Component" v-bind="attrs"></component>
  </transition>
</router-view>
```

# Motivation

As described at https://github.com/vuejs/vue-next/issues/906#issuecomment-611080663, we need a new API to allow the usage of `KeepAlive` and other components accepting slots with `RouterView`. In order to implement such behavior we need to be able to **directly** wrap the component rendered by `RouterView`. The only way to do so by having access to the component rendered by `RouterView` and the _props_ passed to it.

# Detailed design

We can achieve this level of control through a slot:

```vue
<router-view v-slot="{ Component, attrs }">
  <component :is="Component" v-bind="attrs"></component>
</router-view>
```

In the example, `Component` is the _component definition_ that can be passed to the function `h` or to the `is` prop of `component`. `attrs` is a set of event listeners and props that `RouterView` **requires** in order to work properly. Namely, `onVnodeMounted`/`onVnodeUnmounted` and a `ref`. It also contains any _attribute_/_prop_ passed to `RouterView`. Let's say we pass a `class` to it, we will find it in `attrs`:

```vue
<router-view class="view" v-slot="{ attrs }">
  {{ attrs.class }} -> view
</router-view>
```

The same happens with any event listeners directly attached to `RouterView`, they appear on `attrs` **so they can be easily passed down with one singe `v-bind`**.

They also contain any _prop_ passed by using the `props` option in a route record:

```js
createRouter({
  routes: [{ path: '/users/:id', component: User, props: true }],
})
```

This will add a property named `id` with the value corresponding to the url (e.g. `'2'` if we are at `/users/2`) to the `attrs` object.

## No match case

When the current location isn't matched by any record registered by the Router, the `matched` array of a `RouteLocation` is empty and, by default, when no _slot_ is provided, it renders nothing. When we provide a _slot_, we can decide of what to display, whether we want to display a _not found_ page or we want the default behavior, we are able to do it. Unfortunately, this makes it necessary to add a `v-if` directive to `component`:

```vue
<router-view v-slot="{ Component, attrs }">
  <component v-if="Component" :is="Component" v-bind="attrs"></component>
  <div v-else>Not Found</div>
</router-view>
```

Note that this behavior is redundant with the _catch all_ route (`path: '/:pathMatch(.*)`) when it comes to displaying a not found page.

An alternative would be keeping `RouterView`'s default behavior of displaying nothing if no route is matched. This would remove the need of using `v-if`

## `v-slot` properties

- `Component`: _Component_ that can be passed to the function `h` or to the `is` prop of `component`
- `attrs`: set of _event listeners_ and props that `RouterView` **requires** in order to work properly in addition to any _attribute_,_prop_, and _event listener_ directly passed to `RouterView` as well as _props_ generated by the `props` option in a `RouteRecord`.

Other properties such as the current route location could be added but I don't think it's necessary since the route is accessible through `$route` on the template.

# Drawbacks

## Forgetting `v-if="Component"`

Forgetting adding `v-if="Component"` could result in Vue warning when no route is matched:

```txt
[Vue warn]: Invalid vnode type when creating vnode: undefined.
  at <App>
```

The warning not being related to Vue Router in any way, this might be quite confusing. At the same time, given the size of the snippet to use a `Transition` with `RouterView`, people are likely to copy the snippet code with `v-if`, `is` and `v-bind`.

## Forgetting `v-bind="attrs"`

Pretty much the same as the point above of _forgetting `v-if`_.

# Wrapping `RouterView` with `Transition` or `KeepAlive`

If the user accidentally wraps `RouterView` with `Transition` or is migrating their application to Vue 3, we could issue a warning pointing to the documentation (this RFC in the meantime) and hinting them to use the `v-slot` api.

# Alternatives

- Using a function like `useView` that would return `Component` and `attrs` removing the use of `v-slot`.

# Adoption strategy

- A codemod could rewrite v3 to v4.
